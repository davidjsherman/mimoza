<!DOCTYPE html>
<html>
<head>
  <link rel="stylesheet" href="./leaflet.css" />
</head>
<body>
    <div id="map" style="width: 1024px; height: 1024px"></div>

    <script src="./leaflet.js"></script>
    <script src="http://code.jquery.com/jquery-1.10.2.min.js"></script>
    <script src="./gjsn.json"></script>

    <script>
      // map initialize
      var map = L.map('map', {
          maxZoom: 4,
          minZoom: 2,
          crs: L.CRS.Simple,
        }).setView([-128, 128], 2);

      L.tileLayer('./peroxisome/{z}/{x}/{y}.png', {
          continuousWorld: true,
          noWrap: true,
          tileSize: 256,
          reuseTiles: true,
          maxZoom: 4,
          minZoom: 2,
          attribution: 'Peroxisome of YALI',
          tms: true
        }
      ).addTo(map);

      L.geoJson(gjsn, {
          pointToLayer: function (feature, latlng) {
            var e = feature.geometry.coordinates;
            var col = feature.properties.color;
            var x = e[0], y = e[1];
            var r = feature.properties.radius / 2;
            var southWest = map.unproject([x - r, y + r], 1),
                northEast = map.unproject([x + r, y - r], 1),
            bounds = new L.LatLngBounds(southWest, northEast);
            return L.rectangle(bounds,
                               {color: feature.properties.color,
                                  fillColor: feature.properties.color,
                                  fillOpacity: 0,
                                  opacity: 1,
                                  weight: 0,
                                 }
                                );

              <!--return L.circle(map.unproject(e, 1),-->
                                 <!--{radius: feature.properties.radius,-->
                                  <!--color: feature.properties.color,-->
                                  <!--fillColor: feature.properties.color,-->
                                  <!--fillOpacity: 0.1,-->
                                  <!--opacity: 1,-->
                                  <!--weight: 1,-->
                                 <!--}-->
                                <!--);-->
          },
          onEachFeature: function (feature, layer) {
            if (feature.properties.reaction) {
              var ga = feature.properties.gene_association;
              var genes = ga.match(/YALI[\d|\w]+/g);
              if (genes) {
                for (i=0;i < genes.length;i++) {
                  var g = genes[i];
                  ga = ga.replace(g, "<a href='http://genolevures.org/elt/YALI/" + g + "' target='_blank'>" + g + "</a>");
                }
              }
              layer.bindPopup(ga);
            }
            else {
              var ch = feature.properties.chebi.toUpperCase();
              if (ch.indexOf("UNKNOWN") == -1) {
                 ch = "<a href='http://www.ebi.ac.uk/chebi/searchId.do?chebiId=" + ch + "' target='_blank'>" + ch + "</a>";
              } else {
                 ch = "<i>no ChEBI id :(</i>";
              }
              layer.bindPopup(ch);
            }
          },
          maxZoom: 4,
          minZoom: 3,
      }
    ).addTo(map);
  </script>
</body>
</html>
