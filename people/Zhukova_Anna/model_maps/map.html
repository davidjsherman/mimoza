<!DOCTYPE html>
<html>
<head>
  <link rel="stylesheet" href="http://cdn.leafletjs.com/leaflet-0.4/leaflet.css" /> 
</head>
<body>
    <div id="map" style="width: 512px; height: 512px"></div>
    
    <script src="http://cdn.leafletjs.com/leaflet-0.4/leaflet.js"></script>
    <script src="http://code.jquery.com/jquery-1.10.2.min.js"></script>
    <script src="./gjsn.json"></script> 
    
    <script>
      // map initialize
      var map = L.map('map', {
          maxZoom: 4,
          minZoom: 1
        }).setView([0, 0], 1);
      //var southWest = map.unproject([0, 512]),
      //    northEast = map.unproject([512, 0]),
      //    bounds = new L.LatLngBounds(southWest, northEast);
      //map.setMaxBounds(bounds, 1);
      L.tileLayer('./peroxisome/{z}/{x}/{y}.png', {
          continuousWorld: true,
          tileSize: 256,
          reuseTiles: true,
          maxZoom: 4,
          minZoom: 1,
          attribution: 'Peroxisome of YALI',
          tms: true
        }
      ).addTo(map);
    
      L.geoJson(gjsn, {
          pointToLayer: function (feature, latlng) {
            var e = feature.geometry.coordinates;
            var x = e[0], y = e[1];
            var r = feature.properties.radius / 2;
            var southWest = map.unproject([x - r, y + r], 1),
                northEast = map.unproject([x + r, y - r], 1),
            bounds = new L.LatLngBounds(southWest, northEast);
            var col = feature.properties.color;
            return L.rectangle(bounds,
                               {color: feature.properties.color,
                                fillColor: feature.properties.color,
                                fillOpacity: 0.1,
                                opacity: 1,
                                weight: 0,
                               }
                              );
          },
          onEachFeature: function (feature, layer) {
            var ga = feature.properties.gene_association;
            var genes = ga.match(/YALI[\d|\w]+/g);
            if (genes) {
              for (i=0;i < genes.length;i++) {
                var g = genes[i];
                ga = ga.replace(g, "<a href='http://genolevures.org/elt/YALI/" + g + "' target='_blank'>" + g + "</a>");
              }
            }
            layer.bindPopup(ga);
          },
          maxZoom: 4,
          minZoom: 3,          
      }
    ).addTo(map);
    //console.log(gjsn.geometry.coordinates[0]);
    //console.log(gjsn.geometry.coordinates[2]);
    //var bounds = [gjsn.geometry.coordinates[0], gjsn.geometry.coordinates[2]];
    //bounds = new L.LatLngBounds(map.unproject(bounds[0]), map.unproject(bounds[1]));
    //map.setMaxBounds(bounds, 1);
  </script>
</body>
</html>
